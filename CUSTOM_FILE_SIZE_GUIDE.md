# 自定义演示文件大小功能使用指南

## 概述

CastRay系统新增了自定义演示文件大小创建功能，允许用户在传输测试界面中输入自定义的文件大小，然后在服务端创建相应大小的演示文件用于传输测试。

## 功能特性

### 🎯 灵活的文件大小设置
- **数字输入**: 支持1-10240范围的数字输入
- **单位选择**: 支持KB、MB、GB三种常用单位
- **智能验证**: 自动验证输入范围和大小限制
- **安全限制**: 最大文件大小限制为10GB

### 📁 自动文件管理
- **自动命名**: 文件名包含大小信息和时间戳，避免冲突
- **目录管理**: 文件自动保存到`demo_files`目录
- **列表集成**: 创建的文件自动添加到演示文件下拉列表
- **智能替换**: 新创建的自定义文件会替换之前的自定义文件

### 🎨 用户友好界面
- **隐藏显示**: 只有选择"创建自定义大小文件"时才显示输入区域
- **实时反馈**: 提供创建过程的状态反馈和错误提示
- **视觉提示**: 使用颜色和图标提供直观的状态指示
- **自动清理**: 成功消息会自动消失，保持界面简洁

## 使用方法

### Web界面操作

1. **访问传输测试界面**
   ```
   http://localhost:8002
   ```

2. **选择自定义文件选项**
   - 在"演示文件"下拉框中选择"🎯 创建自定义大小文件"
   - 系统将显示自定义文件大小输入区域

3. **输入文件参数**
   - **文件大小**: 输入1-10240之间的数字
   - **大小单位**: 从下拉框选择KB、MB或GB
   - **点击创建**: 点击"📝 创建"按钮开始创建

4. **查看创建结果**
   - 创建成功后，文件会自动添加到演示文件列表
   - 下拉框会自动选择新创建的文件
   - 状态消息会显示创建结果和文件信息

5. **使用新文件进行传输测试**
   - 选择接收节点
   - 点击"🚀 发起文件传输"按钮
   - 观察传输过程和结果

### API接口调用

#### 创建自定义演示文件
```http
POST /api/file-generator/create-demo
Content-Type: application/json

{
    "size": "5MB",
    "content_type": "random"
}
```

#### 响应示例
```json
{
    "success": true,
    "filename": "custom_test_5_mb_142035.bin",
    "actual_size": 5242880,
    "formatted_size": "5.0 MB",
    "content_type": "random",
    "path": "demo_files/custom_test_5_mb_142035.bin"
}
```

## 实际应用场景

### 1. 网络性能测试
```
测试不同文件大小的传输性能:
- 100KB: 测试小文件传输延迟
- 10MB: 测试中等文件传输速度
- 1GB: 测试大文件传输稳定性
```

### 2. 系统压力测试
```
渐进式压力测试:
- 从1MB开始逐步增加到10GB
- 观察系统在不同负载下的表现
- 找出系统的性能瓶颈点
```

### 3. 网络带宽评估
```
带宽利用率测试:
- 创建接近网络带宽的文件大小
- 测试网络的实际传输能力
- 评估传输效率和稳定性
```

## 技术实现细节

### 文件命名规则
```
格式: custom_test_{size_unit}_{timestamp}.bin
示例: custom_test_5_mb_142035.bin

说明:
- custom_test: 固定前缀标识自定义文件
- {size_unit}: 格式化的大小和单位（小写，下划线分隔）
- {timestamp}: HHMMSS格式的时间戳
- .bin: 二进制文件扩展名
```

### 文件内容生成
- **随机内容**: 使用加密安全的随机数生成器
- **均匀分布**: 确保文件内容的随机性和测试有效性
- **实际大小**: 确保生成的文件精确匹配指定大小

### 安全措施
- **大小限制**: 防止创建过大文件导致系统资源耗尽
- **目录隔离**: 文件创建在专门的demo_files目录中
- **文件名安全**: 使用安全的文件名格式避免路径注入

## 界面说明

### 输入区域布局
```
┌─────────────────────────────────────────────────┐
│ 🎯 自定义测试文件大小                             │
├─────────────────────────────────────────────────┤
│ [ 数字输入 ] [单位选择▼] [📝 创建]              │
│ 💡 建议范围：1KB - 10GB，文件将被创建到demo_files目录 │
└─────────────────────────────────────────────────┘
```

### 状态消息类型
- **🔄 加载状态**: 蓝色背景，显示"正在创建测试文件..."
- **✅ 成功状态**: 绿色背景，显示文件创建成功信息
- **❌ 错误状态**: 红色背景，显示错误原因和建议

### 文件列表集成
```
演示文件下拉框:
├── 📄 config.json
├── 📝 data.txt  
├── 📋 report.md
├── 🎯 custom_test_5_mb_142035.bin (5.0 MB)  ← 新创建的文件
└── 🎯 创建自定义大小文件
```

## 故障排除

### 常见问题

1. **文件创建失败**
   ```
   可能原因:
   - 磁盘空间不足
   - 文件大小超出限制
   - 权限不足
   
   解决方案:
   - 检查可用磁盘空间
   - 减小文件大小
   - 确保demo_files目录可写
   ```

2. **文件未出现在列表中**
   ```
   可能原因:
   - 创建过程中发生错误
   - 浏览器缓存问题
   
   解决方案:
   - 检查错误消息
   - 刷新页面重试
   - 查看服务器日志
   ```

3. **传输测试失败**
   ```
   可能原因:
   - 文件路径不正确
   - 节点连接问题
   - 网络传输异常
   
   解决方案:
   - 确认文件确实创建成功
   - 检查节点状态
   - 查看传输日志
   ```

### 调试信息

#### 查看创建的文件
```bash
# 列出demo_files目录
ls demo_files/

# 查看文件大小
ls -lh demo_files/custom_test_*
```

#### 查看服务器日志
```bash
# 实时查看日志
tail -f castray.log

# 查看文件生成相关日志
grep "file-generator" castray.log
```

## 性能建议

### 文件大小建议
- **小文件测试**: 1KB - 1MB，适用于延迟测试
- **中等文件测试**: 1MB - 100MB，适用于吞吐量测试  
- **大文件测试**: 100MB - 10GB，适用于稳定性测试

### 使用最佳实践
1. **逐步测试**: 从小文件开始，逐步增加大小
2. **监控资源**: 创建大文件时监控磁盘和内存使用
3. **清理文件**: 定期清理不需要的测试文件
4. **网络考虑**: 根据网络带宽选择合适的文件大小

## 总结

自定义演示文件大小功能为CastRay系统提供了更灵活的测试能力，用户可以：

- 🎯 **精确控制**: 创建精确大小的测试文件
- ⚡ **快速测试**: 一键创建并集成到传输测试流程
- 📊 **性能评估**: 使用不同大小文件评估系统性能
- 🔧 **简单易用**: 直观的Web界面，无需命令行操作

这个功能特别适用于网络性能测试、系统压力测试和传输效率评估等场景，为用户提供了强大而便捷的测试工具。
